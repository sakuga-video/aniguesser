(this.webpackJsonpaniguesser=this.webpackJsonpaniguesser||[]).push([[0],{124:function(e,t,n){},131:function(e,t,n){},184:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(11),i=n.n(s),o=(n(124),n(17)),c=n(30),u=n(34),l=(n(131),n(222)),d=n(243),j=n(224),g=n(225),b=n(245),m=n(91),p=n(45),v=n(15),h=n(28),f=n(27),O=new(function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(v.a)(this,n),(a=t.call(this,e)).rounds=void 0,a.version(1).stores({rounds:"++id,date,guess,videos,time_to_guess,tag"}),a.rounds=a.table("rounds"),a}return n}(n(93).a))("aniguesser"),x={videos:[],guesses:[],index:0,guess_to_show:void 0,playing:!1,tags:[]},_=Object(p.b)({name:"app",initialState:x,reducers:{mark_played:function(e,t){var n,a=t.payload,r=e.index,s=null===(n=e.guesses[r])||void 0===n?void 0:n.guess,i=e.videos[r][a];e.guesses[r]={guess:s,answers:i.tags},i.played=!0},set_videos:function(e,t){e.videos[e.index]=t.payload},submit_guess:function(e,t){var n=e.index;e.guess_to_show=n,e.guesses[n]=t.payload,n+1<e.tags.length?e.index=n+1:e.playing=!1},stop_showing_guess_results:function(e){e.guess_to_show=void 0},start:function(e,t){e.index=0,e.guess_to_show=void 0,e.guesses=[],e.videos=[],e.playing=!0,e.tags=t.payload},change_guess:function(e,t){var n,a,r=t.payload,s=e.index,i=e.videos[s];i&&(e.guesses[s]={guess:r,answers:null!==(n=null===(a=i[i.length-1])||void 0===a?void 0:a.tags)&&void 0!==n?n:[]})},skip_tag:function(e){e.tags.splice(e.index,1),e.index>=e.tags.length&&(e.index=0,e.playing=!1)}}}),y=_.actions,w=y.mark_played,S=y.stop_showing_guess_results,N=y.start,C=y.submit_guess,k=y.change_guess,I=y.skip_tag,E=y.set_videos,T=function(e){return function(t,n){var a,r=n().app,s=r.guesses,i=r.index,o=r.videos[i],c=r.tags[i];if(void 0!==o&&(null===(a=o[0])||void 0===a?void 0:a.played)){var u,l,d=s[i];if(!d)d={answers:null!==(u=null===(l=o[o.length-1])||void 0===l?void 0:l.tags)&&void 0!==u?u:[]};O.rounds.put({date:Date.now(),guess:d.guess,videos:o.filter((function(e){return e.played})),time_to_guess:e,tag:c}).then((function(){return t(C(d))})).catch(console.log)}}},R=_.reducer,F=n(218),B=n(221),z=n(94),A=n(4),P=function(e){var t=e.duration,n=e.size,r=e.type,s=e.on_time_over,i=e.interval,c=void 0===i?50:i,u=e.className,l=e.count_down,d=void 0!==l&&l,j=e.show_emergency_color,g=void 0!==j&&j,b=1e3*t/c,m=Object(z.useTimer)({endTime:b,interval:c,onTimeOver:s}),p=m.time,v=m.start,h=m.reset;Object(a.useEffect)((function(){return v(),h}),[h,v]);var f=function(e){return 100*(d?b-e:e)/b},O={color:f(p)<25&&g?"secondary":"primary",variant:"determinate",value:f(p),className:u};return"linear"===r?Object(A.jsx)(F.a,Object(o.a)({},O)):Object(A.jsx)(B.a,Object(o.a)({size:n},O))},G=Object(l.a)({wrapper:{position:"relative"},fabProgress:{position:"absolute",top:-6,left:-6}}),H={keys:[function(e){return e.name}],baseSort:function(e,t){return t.item.count-e.item.count}},L=function(e,t){var n=t.inputValue;return n?Object(m.a)(e,n,H).slice(0,100):[]},D=function(e){var t=e.all_tags,n=qe(),r=G(),s=Object(a.useState)(null),i=Object(c.a)(s,2),u=i[0],l=i[1];return Object(A.jsxs)("form",{id:"guess",onSubmit:function(e){e.preventDefault(),u&&n(T(0))},children:[Object(A.jsx)("div",{id:"guess-input",children:Object(A.jsx)(b.a,{selectOnFocus:!0,clearOnBlur:!0,autoHighlight:!0,autoComplete:!0,disableClearable:!0,clearOnEscape:!0,options:t,style:{width:300},filterOptions:L,getOptionLabel:function(e){return e.name},onChange:function(e,t){var a;l(t),n(k(null!==(a=null===t||void 0===t?void 0:t.name)&&void 0!==a?a:""))},renderInput:function(e){return Object(A.jsx)(d.a,Object(o.a)(Object(o.a)({},e),{},{label:"Guess the title",variant:"filled",autoFocus:!0}))}})}),Object(A.jsxs)("div",{className:r.wrapper,children:[Object(A.jsx)(P,{size:68,duration:30,on_time_over:function(){return n(T(30))},count_down:!0,show_emergency_color:!0,className:r.fabProgress}),Object(A.jsx)(j.a,{type:"submit","area-label":"submit",children:Object(A.jsx)(g.a,{})})]})]})},Y=n(72),J=n.n(Y),M=n(52),V=n.n(M),X=n(73);function q(){return(q=Object(X.a)(V.a.mark((function e(){var t,n;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/tag.json?limit=0&order=count&type="+ge.COPYRIGHT);case 2:return t=e.sent,e.next=5,t.json();case 5:return n=e.sent.map(Q),e.abrupt("return",n.filter((function(e){return e.count>0})));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(){return(K=Object(X.a)(V.a.mark((function e(t){var n,a,r,s=arguments;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:8,a="/api/post.json?tags=rating:safe order:random ext:mp4,webm "+t.name.split(" ").join("_")+"&limit="+n,e.next=4,fetch(a);case 4:return r=e.sent,e.next=7,r.json();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Q=function(e){return{count:e.count,id:e.id,name:e.name.split("_").join(" ")}},U=function(e,t){return(e+1)%t},W=function(e){var t,n,s=e.tag,i=e.videos,o=e.video_wrapper,u=e.should_play,l=qe(),d=Object(a.useState)(!0),j=Object(c.a)(d,2),g=j[0],b=j[1],m=Object(a.useState)(0),p=Object(c.a)(m,2),v=p[0],h=p[1];Object(a.useEffect)((function(){var e=!0;return h(0),function(e){return K.apply(this,arguments)}(s).then((function(e){return e.map(o.wrap)})).then((function(t){e&&(t.length>0?(h(0),l(E(t))):l(I()))})),function(){e=!1}}),[s,o,l]);var f=function(){if(i.length>1){var e=U(v,i.length);h(e)}};return Object(A.jsxs)(r.a.Fragment,{children:[(0===i.length||g)&&u&&Object(A.jsx)(B.a,{className:"video-loading"}),Object(A.jsx)(J.a,{muted:!0,onBuffer:function(){return b(!0)},onStart:function(){l(w(v)),b(!1)},onPlay:function(){return b(!1)},playing:u,loop:1===i.length,onError:f,url:null===(t=i[v])||void 0===t?void 0:t.url,style:u?{visibility:"visible"}:{},className:u?"active":"",id:"main-video",controls:!1,width:"100%",height:"auto",onEnded:function(){f()}},v),i.length>1&&Object(A.jsx)(J.a,{muted:!0,id:"preloading-video",url:null===(n=i[U(v,i.length)])||void 0===n?void 0:n.url},U(v,i.length))]})},Z=n(60),$=n(108),ee=n(226),te=n(227),ne=Object(l.a)({timer:{width:"100%"},root:{width:400,height:200,display:"flex",flexDirection:"column",justifyContent:"space-evenly",alignItems:"center"}}),ae=function(e){return e.length>0?Object(A.jsxs)(te.a,{variant:"body1",children:["it was ",Object(Z.sortBy)(e,(function(e){return e.count}))[e.length-1].name]}):null},re=function(e){var t=e.guess,n=e.answers,a=e.closest_answer,r=e.result,s=e.is_exact,i=qe(),o=ne(),c=Object(A.jsx)(P,{duration:4,on_time_over:function(){return i(S())},type:"linear",className:o.timer});return Object(A.jsxs)($.a,{children:[Object(A.jsxs)(ee.a,{className:o.root,children:["missing"!==r&&Object(A.jsx)(te.a,{variant:"body1",children:t}),"correct"===r&&!s&&Object(A.jsxs)(te.a,{variant:"body1",children:["(",a,")"]}),Object(A.jsx)(te.a,{variant:"h3",component:"p",children:{correct:"\ud83c\udf89 is correct \ud83c\udf8a",incorrect:"is incorrect",missing:"No guess"}[r]}),"correct"!==r&&ae(n)]}),c]})},se=n(104),ie=function(e){var t,n;if(!e.guess)return{result:"missing",is_exact:!1};var a=new se.a(e.answers.map((function(e){return e.name})),{includeScore:!0,threshold:.1}).search(e.guess);return{result:a.length>0?"correct":"incorrect",is_exact:0===(null===(t=a[0])||void 0===t?void 0:t.score),closest_answer:null===(n=a[0])||void 0===n?void 0:n.item}},oe=n(101),ce=function e(t){var n=this;Object(v.a)(this,e),this.tags_by_name=void 0,this.wrap=function(e){return{tags:e.tags.split(" ").map((function(e){return e.split("_").join(" ")})).map((function(e){return n.tags_by_name.get(e)})).filter((function(e){return void 0!==e})),url:e.file_url,id:e.id,preview_url:e.preview_url}},this.tags_by_name=Object(oe.a)(t.map((function(e){return[e.name,e]})))},ue=n(228),le=n(102),de=n.n(le);function je(e){return be.map((function(t){var n=t.max,a=t.min;return de()(e.filter((function(e){var t=e.count;return n>=t&&t>=a})))}))}var ge,be=[{max:1e5,min:500},{max:1e5,min:500},{max:1e5,min:500},{max:500,min:100},{max:500,min:100},{max:500,min:100},{max:500,min:100},{max:500,min:100},{max:100,min:25},{max:25,min:1},{max:25,min:1},{max:1,min:1}],me=function(e){var t=e.all_tags,n=qe();return t.length>0?Object(A.jsx)(ue.a,{variant:"contained",onClick:function(){return n(N(je(t)))},id:"start",children:"Start"}):Object(A.jsx)(B.a,{})},pe=n(233),ve=n(229),he=n(230),fe=n(231),Oe=n(232),xe=Object(l.a)({title:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},media:{height:240}}),_e=function(e,t){var n='"'+e+'" ';return{missing:"No guess",correct:n+"\ud83c\udf89 was correct \ud83c\udf8a",incorrect:n+"was incorrect"}[ie({guess:e,answers:t}).result]},ye=function(e){var t,n=e.round,a=xe(),r=n.videos[n.videos.length-1],s=Object(Z.sortBy)(r.tags,["count"]),i=s[s.length-1];return Object(A.jsx)(ve.a,{children:Object(A.jsxs)(he.a,{href:(t=i,"https://www.sakugabooru.com/post?tags="+t.name.split(" ").join("_")),target:"_blank",children:[Object(A.jsx)(fe.a,{component:"img",title:"Image thumbnail of a clip from "+n.videos[0].tags[0].name,alt:"Image thumbnail of a clip from "+n.videos[0].tags[0].name,image:n.videos[0].preview_url,className:a.media}),Object(A.jsxs)(Oe.a,{children:[Object(A.jsx)(te.a,{gutterBottom:!0,variant:"h6",component:"h2",className:a.title,children:i.name}),Object(A.jsx)(te.a,{variant:"body2",component:"p",children:_e(n.guess,s)})]})]})})},we=function(e){var t=e.rounds;return Object(A.jsx)(pe.a,{container:!0,spacing:2,children:t.map((function(e,t){var n;return Object(A.jsx)(pe.a,{item:!0,className:"round-summary",xs:12,sm:6,md:4,children:Object(A.jsx)(ye,{round:e})},null!==(n=e.id)&&void 0!==n?n:t)}))})},Se=Object(l.a)({root:{paddingBottom:56}}),Ne=function(e){var t=e.rounds,n=e.all_tags,a=qe(),r=Se();return Object(A.jsxs)(ee.a,{classes:r,children:[Object(A.jsx)(te.a,{variant:"h3",component:"h1",gutterBottom:!0,align:"center",children:"Game Summary"}),Object(A.jsx)("div",{id:"play-again",children:Object(A.jsx)(ue.a,{variant:"contained",onClick:function(){return a(N(je(n)))},color:"primary",children:"Play Again"})}),Object(A.jsx)(we,{rounds:t})]})},Ce=n(42),ke=n(5),Ie=n(186),Ee=n(234),Te=n(235),Re=n(247),Fe=n(2),Be=Object(l.a)((function(e){return{root:{display:"flex",height:22,alignItems:"center",color:e.palette.background.default},active:{color:e.palette.text.primary},circle:{width:6,height:6,borderRadius:"50%",border:"1px solid #aaa",backgroundColor:"currentColor"},completed:{color:e.palette.secondary.main,zIndex:1,fontSize:18,border:"none"},correct:{color:e.palette.primary.main}}})),ze=function(e){var t=Be();return function(n){var a=n.active,r=n.completed,s=t.circle;return r&&(s+=" "+t.completed,e&&(s+=" "+t.correct)),Object(A.jsx)("div",{className:Object(Fe.a)(t.root,Object(Ce.a)({},t.active,a)),children:Object(A.jsx)("div",{className:s})})}},Ae=Object(l.a)({root:{background:"rgba(2, 2, 2, .5)",zIndex:1e5,height:22,padding:8,margin:5,borderRadius:"10px",position:"fixed",bottom:10,left:"50%",transform:"translateX(-50%)"}}),Pe=Object(ke.a)({root:{display:"none"}})(Ie.a),Ge=function(e){var t=e.activeStep,n=e.steps,a=e.guesses,r=Ae(),s=ze(!0),i=ze(!1);return Object(A.jsx)(Ee.a,{activeStep:t,className:r.root,connector:Object(A.jsx)(Pe,{}),children:n.map((function(e,t){var n=a[t]&&"correct"===ie(a[t]).result;return Object(A.jsx)(Te.a,{children:Object(A.jsx)(Re.a,{StepIconComponent:n?s:i})},t)}))})},He=n(244),Le=n(236),De=n(237),Ye=n(238),Je=n(239),Me=n(51),Ve=Object(l.a)({root:{position:"fixed",zIndex:999,bottom:0,width:"100%",marginTop:-56}}),Xe=function(){var e=window.location.pathname,t=Object(a.useState)(e),n=Object(c.a)(t,2),r=n[0],s=n[1],i=Ve();return Object(A.jsx)(He.a,{className:i.root,children:Object(A.jsxs)(Le.a,{value:r,onChange:function(e,t){s(t)},showLabels:!0,children:[Object(A.jsx)(De.a,{label:"Play",value:"/",icon:Object(A.jsx)(Ye.a,{}),component:Me.b,to:"/"}),Object(A.jsx)(De.a,{label:"History",value:"/history",icon:Object(A.jsx)(Je.a,{}),component:Me.b,to:"/history"})]})})};!function(e){e[e.GENERAL=0]="GENERAL",e[e.ARTIST=1]="ARTIST",e[e.COPYRIGHT=3]="COPYRIGHT",e[e.CHARACTER=4]="CHARACTER"}(ge||(ge={}));var qe=function(){return Object(u.b)()};var Ke=function(){var e,t=Object(u.c)((function(e){return e.app})),n=t.guesses,s=t.index,i=t.videos,l=t.guess_to_show,d=t.playing,j=t.tags,g=Object(u.c)((function(e){for(var t=e.app,n=t.tags.length,a=[],r=0;r<n;r++){var s,i;a.push({tag:t.tags[r],videos:null===(s=t.videos[r])||void 0===s?void 0:s.filter((function(e){return e.played})),guess:null===(i=t.guesses[r])||void 0===i?void 0:i.guess,date:Date.now(),time_to_guess:0})}return a})),b=Object(u.c)((function(e){var t=e.app.guess_to_show;return void 0===t?void 0:ie(e.app.guesses[t])})),m=Object(a.useState)([]),p=Object(c.a)(m,2),v=p[0],h=p[1],f=Object(a.useState)(void 0),O=Object(c.a)(f,2),x=O[0],_=O[1];return Object(a.useEffect)((function(){(function(){return q.apply(this,arguments)})().then((function(e){h(e),_(new ce(e))}))}),[]),!d&&n.length>0&&void 0===l?Object(A.jsxs)(r.a.Fragment,{children:[Object(A.jsx)(Ne,{rounds:g,all_tags:v}),Object(A.jsx)(Xe,{})]}):Object(A.jsxs)("div",{id:"game",children:[!d&&0===n.length&&Object(A.jsxs)(r.a.Fragment,{children:[Object(A.jsx)(me,{all_tags:v}),Object(A.jsx)(Xe,{})]}),d&&j.length>0&&x&&Object(A.jsxs)(r.a.Fragment,{children:[Object(A.jsx)(W,{tag:j[s],videos:null!==(e=i[s])&&void 0!==e?e:[],video_wrapper:x,should_play:void 0===l}),void 0===l&&i[s]&&Object(A.jsx)(D,{all_tags:v})]}),(d||s>0)&&j.length>0&&Object(A.jsx)(Ge,{activeStep:s,steps:j.map((function(e){return e.name})),guesses:n}),void 0!==l&&void 0!==b&&Object(A.jsx)(re,Object(o.a)(Object(o.a)({},b),n[l]))]})},Qe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,249)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,s=t.getLCP,i=t.getTTFB;n(e),a(e),r(e),s(e),i(e)}))},Ue=n(241),We=Object(p.b)({name:"history",initialState:{rounds:[],page:0,num_rounds:0},reducers:{set_rounds:function(e,t){e.rounds=t.payload.rounds,e.page=t.payload.page},set_num_rounds:function(e,t){e.num_rounds=t.payload}}}),Ze=We.actions,$e=Ze.set_rounds,et=Ze.set_num_rounds,tt=function(e){var t=e.page,n=e.page_size;return function(e){O.rounds.orderBy("date").reverse().offset(t*n).limit(n).toArray().then((function(n){return e($e({page:t,rounds:n}))}))}},nt=We.reducer,at=Object(p.a)({reducer:{app:R,history:nt}}),rt=n(242),st=n(13),it=n(246),ot=Object(l.a)({pagination:{margin:"1em 0"},container:{paddingBottom:56}}),ct=function(){var e=qe(),t=Object(u.c)((function(e){return e.history})),n=t.rounds,s=t.num_rounds,i=t.page,o=ot();Object(a.useEffect)((function(){return e((function(e){O.rounds.count().then((function(t){return e(et(t))}))}))}),[e]),Object(a.useEffect)((function(){return e(tt({page:0,page_size:12}))}),[e]);var c=Object(A.jsxs)(r.a.Fragment,{children:[Object(A.jsx)(we,{rounds:n}),Object(A.jsx)(it.a,{className:o.pagination,page:i+1,count:Math.ceil(s/12),onChange:function(t,n){e(tt({page:n-1,page_size:12}))}})]});return Object(A.jsxs)(r.a.Fragment,{children:[Object(A.jsx)(ee.a,{className:o.container,children:0===n.length?Object(A.jsx)("h1",{children:"No game history"}):c}),Object(A.jsx)(Xe,{})]})},ut=n(103),lt=n(240),dt=n(62),jt=Object(ut.a)({palette:{type:"dark",primary:lt.a,secondary:dt.a}});i.a.render(Object(A.jsx)(r.a.StrictMode,{children:Object(A.jsxs)(Ue.a,{theme:jt,children:[Object(A.jsx)(rt.a,{}),Object(A.jsx)(u.a,{store:at,children:Object(A.jsx)(Me.a,{children:Object(A.jsxs)(st.c,{children:[Object(A.jsx)(st.a,{path:"/history",children:Object(A.jsx)(ct,{})}),Object(A.jsx)(st.a,{path:"/",children:Object(A.jsx)(Ke,{})})]})})})]})}),document.getElementById("root")),Qe()}},[[184,1,2]]]);
//# sourceMappingURL=main.801cff5f.chunk.js.map