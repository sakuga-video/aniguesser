(this.webpackJsonpaniguesser=this.webpackJsonpaniguesser||[]).push([[0],{111:function(e,t,n){},118:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(11),s=n.n(c),u=(n(83),n(18)),i=n.n(u),o=n(22),l=n(12),j=n(60),f=n.n(j),b=(n(111),n(17)),d=n(163),m=n(157),O=n(158),v=n(164),p=n(7);function g(){return(g=Object(o.a)(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/tag.json?limit=25&type=3&order=count&name="+t.toLowerCase().replaceAll(" ","_"));case 2:return n=e.sent,e.next=5,n.json();case 5:return r=e.sent,e.abrupt("return",r.filter((function(e){return e.count>0})));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var x=function(e){var t=e.on_guess_changed,n=e.on_guess_submitted,a=Object(r.useState)([]),c=Object(l.a)(a,2),s=c[0],u=c[1],i=Object(r.useState)(""),o=Object(l.a)(i,2),j=o[0],f=o[1];Object(r.useEffect)((function(){j?function(e){return g.apply(this,arguments)}(j).then(u):u([])}),[j]);return Object(p.jsxs)("form",{id:"guess",onSubmit:function(e){e.preventDefault(),n()},children:[Object(p.jsx)(v.a,{selectOnFocus:!0,clearOnBlur:!0,autoHighlight:!0,autoComplete:!0,disableClearable:!0,clearOnEscape:!0,options:s,style:{width:300},getOptionLabel:function(e){return e.name.replaceAll("_"," ")},onChange:function(e,n){var r;return t(null!==(r=null===n||void 0===n?void 0:n.name)&&void 0!==r?r:"")},onInputChange:function(e,t){return f(t)},renderInput:function(e){return Object(p.jsx)(d.a,Object(b.a)(Object(b.a)({},e),{},{label:"Guess the title",variant:"filled"}))}}),Object(p.jsx)(m.a,{type:"submit",children:Object(p.jsx)(O.a,{children:"send"})})]})},h=n(159),_=n(68),S=3e4,w=function(e){return 100*(S-e)/S},y=function(e,t){return(e+1)%t.count};var C,I=function(e){var t=e.tag,n=e.current_video,c=e.set_current_video,s=e.play_next_tag,u=Object(r.useState)(void 0),j=Object(l.a)(u,2),f=j[0],b=j[1],d=Object(r.useState)(0),m=Object(l.a)(d,2),O=m[0],v=m[1];Object(r.useEffect)((function(){var e=!0;return g({tag:t}).then((function(t){e&&c(t)})),function(){e=!1}}),[t,c]),Object(r.useEffect)((function(){var e=0;console.log("starting interval");var t=setInterval((function(){e>=S?(v(e=0),s()):v(e+=50)}),50);return function(){clearInterval(t),console.log("clearing interval")}}),[t]);var g=function(){var e=Object(o.a)(i.a.mark((function e(t){var n,r,a,c,s,u,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.tag,a=t.page,c=null!==(n=c=void 0===a?void 0:a)&&void 0!==n?n:Object(_.random)(r.count),s="/api/post.json?limit=1&page="+c+"&tags="+r.name,e.next=5,fetch(s);case 5:return u=e.sent,e.next=8,u.json();case 8:if(o=e.sent,!(i=o[0])||!i.file_url||"mp4"!==i.file_ext&&"webm"!==i.file_ext||!i.id){e.next=14;break}return b(c),e.abrupt("return",{url:o[0].file_url,id:o[0].id,tag:r});case 14:return e.abrupt("return",g({tag:r,page:y(c,r)}));case 15:case"end":return e.stop()}var i}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(p.jsxs)(a.a.Fragment,{children:[Object(p.jsx)(h.a,{color:w(O)<25?"secondary":"primary",variant:"determinate",value:w(O),className:"controls timer"},t.id),Object(p.jsx)("video",{muted:!0,preload:"auto",autoPlay:!0,src:null===n||void 0===n?void 0:n.url,onEnded:function(){var e=y(f,t);g({tag:t,page:e}).then((function(e){c(e)}))}})]})},A=n(160),E=n(47),R=function(e){var t=e.guess_result;return void 0===t?null:t.is_correct&&t.guess?Object(p.jsxs)("p",{id:"guess-result",className:"controls correct",children:[t.guess.replaceAll("_"," ")," (",t.correct_answer.replaceAll("_"," "),") \u2713"]}):t.guess?Object(p.jsxs)("div",{id:"guess-result",className:"controls wrong",children:[Object(p.jsx)("p",{id:"incorrect-guess",children:t.guess.replaceAll("_"," ")}),Object(p.jsx)("p",{children:t.correct_answer.replaceAll("_"," ")})]}):Object(p.jsx)("div",{id:"guess-result",className:"controls wrong",children:Object(p.jsx)("p",{children:t.correct_answer.replaceAll("_"," ")})})},T=function(e){var t=e.score,n=e.max_score;return Object(p.jsxs)("p",{id:"score",className:"controls",children:["Correct: ",t,"/",n]})},k=n(70),N=function(e){return new k.a([e.answer],{includeScore:!0,threshold:.1,distance:0}).search(e.guess).length>0};!function(e){e[e.GENERAL=0]="GENERAL",e[e.ARTIST=1]="ARTIST",e[e.COPYRIGHT=3]="COPYRIGHT",e[e.CHARACTER=4]="CHARACTER"}(C||(C={}));var F=3500,G=function(e){return 100*e/F};function H(e,t){return void 0!==e&&N({guess:e,answer:t.name})}function L(){return(L=Object(o.a)(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/tag.json?limit=0&order=count&type="+C.COPYRIGHT);case 2:return t=e.sent,e.next=5,t.json();case 5:return n=e.sent,e.abrupt("return",n.filter((function(e){return e.count>0})));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var P=[{max:1e5,min:500},{max:1e5,min:500},{max:1e5,min:500},{max:500,min:100},{max:500,min:100},{max:500,min:100},{max:500,min:100},{max:500,min:100},{max:500,min:100},{max:100,min:25},{max:100,min:25},{max:100,min:25},{max:100,min:25},{max:25,min:10},{max:25,min:10},{max:25,min:10},{max:25,min:10},{max:1,min:1}],B=function(){var e=Object(r.useState)(0),t=Object(l.a)(e,2),n=t[0],c=t[1],s=Object(r.useState)([]),u=Object(l.a)(s,2),i=u[0],o=u[1],j=Object(r.useState)([]),b=Object(l.a)(j,2),d=b[0],m=b[1],O=Object(r.useState)(!1),v=Object(l.a)(O,2),g=v[0],_=v[1],S=Object(r.useState)(!1),w=Object(l.a)(S,2),y=w[0],C=w[1],k=Object(r.useState)(Object(E.a)()),N=Object(l.a)(k,2),B=N[0],Y=N[1],D=Object(r.useState)(void 0),J=Object(l.a)(D,2),M=J[0],q=J[1],z=Object(r.useState)(0),K=Object(l.a)(z,2),Q=K[0],U=K[1],V=Object(r.useState)(0),W=Object(l.a)(V,2),X=W[0],Z=W[1],$=Object(r.useState)(void 0),ee=Object(l.a)($,2),te=ee[0],ne=ee[1],re=Object(r.useState)(0),ae=Object(l.a)(re,2),ce=ae[0],se=ae[1];Object(r.useEffect)((function(){var e=10;c(e);var t=setInterval((function(){e<90?c(e+=10):clearInterval(t)}),100);return function(){return L.apply(this,arguments)}().then((function(e){c(100),o(e)})),function(){return clearInterval(t)}}),[]),Object(r.useEffect)((function(){if(te){oe(B);var e=0,t=setInterval((function(){e>=F?(ne(void 0),e=0):e+=50,se(e)}),50);return function(){return clearInterval(t)}}}),[B,te]);var ue=function(){var e=d[X];ne(e),X+1<d.length?Z(X+1):ie()},ie=function(){_(!1),m([])},oe=function(e){var t=0;e.forEach((function(e,n){H(e,n)&&(t+=1)})),U(t)};return Object(p.jsxs)(a.a.Fragment,{children:[te&&Object(p.jsx)(h.a,{variant:"determinate",value:G(ce),className:"controls timer"},X),y&&Object(p.jsx)(T,{score:Q,max_score:X}),0===i.length&&Object(p.jsx)(h.a,{variant:"determinate",value:n}),!g&&Object(p.jsx)(A.a,{variant:"contained",disabled:0===i.length,onClick:function(){var e;m((e=i,P.map((function(t){var n=t.max,r=t.min;return f()(e.filter((function(e){var t=e.count;return n>=t&&t>=r})))})))),_(!0),C(!0),Y(Object(E.a)()),U(0),Z(0)},id:"start",children:"Start"}),g&&d.length>0&&!te&&Object(p.jsx)(I,{tag:d[X],current_video:M,set_current_video:q,play_next_tag:ue}),te&&Object(p.jsx)(R,{guess_result:{guess:B.get(te),correct_answer:te.name,is_correct:H(B.get(te),te)}}),g&&!te&&Object(p.jsx)(x,{on_guess_changed:function(e){var t=d[X];if(t){var n=B.set(t,e);Y(n)}},on_guess_submitted:function(){var e=d[X];B.get(e)&&ue()}})]})},Y=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,165)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,s=t.getTTFB;n(e),r(e),a(e),c(e),s(e)}))},D=n(162),J=n(69),M=n(161),q=n(39),z=Object(J.a)({palette:{type:"dark",primary:M.a,secondary:q.a}});s.a.render(Object(p.jsx)(a.a.StrictMode,{children:Object(p.jsx)(D.a,{theme:z,children:Object(p.jsx)(B,{})})}),document.getElementById("root")),Y()},83:function(e,t,n){}},[[118,1,2]]]);
//# sourceMappingURL=main.275ec87e.chunk.js.map