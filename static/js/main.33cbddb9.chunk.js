(this.webpackJsonpaniguesser=this.webpackJsonpaniguesser||[]).push([[0],{118:function(e,t,n){},125:function(e,t,n){},160:function(e,t,n){"use strict";n.r(t);var s=n(0),a=n.n(s),r=n(11),i=n.n(r),c=(n(118),n(17)),o=n(27),u=n(32),l=(n(125),n(198)),d=n(219),j=n(200),g=n(201),m=n(221),b=n(85),p=n(42),h=n(15),v=n(25),f=n(24),O=new(function(e){Object(v.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(h.a)(this,n),(s=t.call(this,e)).guesses=void 0,s.version(1).stores({guesses:"++id,date,guess,videos,time_to_guess"}),s.guesses=s.table("guesses"),s}return n}(n(87).a))("aniguesser"),x={videos:[],guesses:[],index:0,guess_to_show:void 0,playing:!1,tags:[]},_=Object(p.b)({name:"app",initialState:x,reducers:{mark_played:function(e,t){var n,s=t.payload,a=e.index,r=null===(n=e.guesses[a])||void 0===n?void 0:n.guess,i=e.videos[a][s];e.guesses[a]={guess:r,answers:i.tags},i.played=!0},set_videos:function(e,t){e.videos[e.index]=t.payload},submit_guess:function(e,t){var n=e.index;e.guess_to_show=n,e.guesses[n]=t.payload,n+1<e.tags.length?e.index=n+1:e.playing=!1},stop_showing_guess_results:function(e){e.guess_to_show=void 0},start:function(e,t){e.index=0,e.guess_to_show=void 0,e.guesses=[],e.videos=[],e.playing=!0,e.tags=t.payload},change_guess:function(e,t){var n,s,a=t.payload,r=e.index,i=e.videos[r];i&&(e.guesses[r]={guess:a,answers:null!==(n=null===(s=i[i.length-1])||void 0===s?void 0:s.tags)&&void 0!==n?n:[]})},skip_tag:function(e){e.tags.splice(e.index,1),e.index>=e.tags.length&&(e.index=0,e.playing=!1)}}}),y=_.actions,w=y.mark_played,N=y.stop_showing_guess_results,S=y.start,C=y.submit_guess,k=y.change_guess,I=y.skip_tag,E=y.set_videos,T=function(e){return function(t,n){var s,a=n().app,r=a.guesses,i=a.index,c=a.videos[i];if(void 0!==c&&(null===(s=c[0])||void 0===s?void 0:s.played)){var o,u,l=r[i];if(!l)l={answers:null!==(o=null===(u=c[c.length-1])||void 0===u?void 0:u.tags)&&void 0!==o?o:[]};O.guesses.put({date:Date.now(),guess:l.guess,videos:c.filter((function(e){return e.played})),time_to_guess:e}).then((function(){return t(C(l))})).catch(console.log)}}},R=_.reducer,F=n(194),B=n(197),P=n(88),z=n(4),A=function(e){var t=e.duration,n=e.size,a=e.type,r=e.on_time_over,i=e.interval,o=void 0===i?50:i,u=e.className,l=e.count_down,d=void 0!==l&&l,j=e.show_emergency_color,g=void 0!==j&&j,m=1e3*t/o,b=Object(P.useTimer)({endTime:m,interval:o,onTimeOver:r}),p=b.time,h=b.start,v=b.reset;Object(s.useEffect)((function(){return h(),v}),[v,h]);var f=function(e){return 100*(d?m-e:e)/m},O={color:f(p)<25&&g?"secondary":"primary",variant:"determinate",value:f(p),className:u};return"linear"===a?Object(z.jsx)(F.a,Object(c.a)({},O)):Object(z.jsx)(B.a,Object(c.a)({size:n},O))},H=Object(l.a)({wrapper:{position:"relative"},fabProgress:{position:"absolute",top:-6,left:-6}}),G={keys:[function(e){return e.name}],baseSort:function(e,t){return t.item.count-e.item.count}},L=function(e,t){var n=t.inputValue;return n?Object(b.a)(e,n,G).slice(0,100):[]},D=function(e){var t=e.all_tags,n=Me(),a=H(),r=Object(s.useState)(null),i=Object(o.a)(r,2),u=i[0],l=i[1];return Object(z.jsxs)("form",{id:"guess",onSubmit:function(e){e.preventDefault(),u&&n(T(0))},children:[Object(z.jsx)("div",{id:"guess-input",children:Object(z.jsx)(m.a,{selectOnFocus:!0,clearOnBlur:!0,autoHighlight:!0,autoComplete:!0,disableClearable:!0,clearOnEscape:!0,options:t,style:{width:300},filterOptions:L,getOptionLabel:function(e){return e.name},onChange:function(e,t){var s;l(t),n(k(null!==(s=null===t||void 0===t?void 0:t.name)&&void 0!==s?s:""))},renderInput:function(e){return Object(z.jsx)(d.a,Object(c.a)(Object(c.a)({},e),{},{label:"Guess the title",variant:"filled",autoFocus:!0}))}})}),Object(z.jsxs)("div",{className:a.wrapper,children:[Object(z.jsx)(A,{size:68,duration:30,on_time_over:function(){return n(T(30))},count_down:!0,show_emergency_color:!0,className:a.fabProgress}),Object(z.jsx)(j.a,{type:"submit","area-label":"submit",children:Object(z.jsx)(g.a,{})})]})]})},Y=n(50),J=n.n(Y),M=n(70);function V(){return(V=Object(M.a)(J.a.mark((function e(){var t,n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/tag.json?limit=0&order=count&type="+pe.COPYRIGHT);case 2:return t=e.sent,e.next=5,t.json();case 5:return n=e.sent.map(X),e.abrupt("return",n.filter((function(e){return e.count>0})));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(){return(W=Object(M.a)(J.a.mark((function e(t){var n,s,a,r=arguments;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:8,s="/api/post.json?tags=rating:safe order:random ext:mp4,webm "+t.name.split(" ").join("_")+"&limit="+n,e.next=4,fetch(s);case 4:return a=e.sent,e.next=7,a.json();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var X=function(e){return{count:e.count,id:e.id,name:e.name.split("_").join(" ")}},q=function(e,t){return(e+1)%t},K=function(e){var t,n,r=e.tag,i=e.videos,c=e.video_wrapper,u=e.should_play,l=Me(),d=Object(s.useState)(!0),j=Object(o.a)(d,2),g=j[0],m=j[1],b=Object(s.useState)(0),p=Object(o.a)(b,2),h=p[0],v=p[1];Object(s.useEffect)((function(){var e=!0;return v(0),function(e){return W.apply(this,arguments)}(r).then((function(e){return e.map(c.wrap)})).then((function(t){e&&(t.length>0?(v(0),l(E(t))):l(I()))})),function(){e=!1}}),[r,c,l]);var f=function(){if(i.length>1){var e=q(h,i.length);v(e)}};return Object(z.jsxs)(a.a.Fragment,{children:[(0===i.length||g)&&u&&Object(z.jsx)(B.a,{className:"video-loading"}),Object(z.jsx)("video",{muted:!0,onWaiting:function(){return m(!0)},onPlay:function(){l(w(h)),m(!1)},autoPlay:u,loop:1===i.length,onError:f,src:null===(t=i[h])||void 0===t?void 0:t.url,className:u?"active":"",onEnded:function(){m(!0),f()}},h),i.length>1&&Object(z.jsx)("video",{muted:!0,preload:"auto",src:null===(n=i[q(h,i.length)])||void 0===n?void 0:n.url},q(h,i.length))]})},Q=n(58),U=n(102),Z=n(202),$=n(203),ee=Object(l.a)({timer:{width:"100%"},root:{width:400,height:200,display:"flex",flexDirection:"column",justifyContent:"space-evenly",alignItems:"center"}}),te=function(e){return e.length>0?Object(z.jsxs)($.a,{variant:"body1",children:["it was ",Object(Q.sortBy)(e,(function(e){return e.count}))[e.length-1].name]}):null},ne=function(e){var t=e.guess,n=e.answers,s=e.closest_answer,a=e.result,r=e.is_exact,i=Me(),c=ee(),o=Object(z.jsx)(A,{duration:4,on_time_over:function(){return i(N())},type:"linear",className:c.timer});return Object(z.jsxs)(U.a,{children:[Object(z.jsxs)(Z.a,{className:c.root,children:["missing"!==a&&Object(z.jsx)($.a,{variant:"body1",children:t}),"correct"===a&&!r&&Object(z.jsxs)($.a,{variant:"body1",children:["(",s,")"]}),Object(z.jsx)($.a,{variant:"h3",component:"p",children:{correct:"\ud83c\udf89 is correct \ud83c\udf8a",incorrect:"is incorrect",missing:"No guess"}[a]}),"correct"!==a&&te(n)]}),o]})},se=n(98),ae=function(e){var t,n;if(!e.guess)return{result:"missing",is_exact:!1};var s=new se.a(e.answers.map((function(e){return e.name})),{includeScore:!0,threshold:.1}).search(e.guess);return{result:s.length>0?"correct":"incorrect",is_exact:0===(null===(t=s[0])||void 0===t?void 0:t.score),closest_answer:null===(n=s[0])||void 0===n?void 0:n.item}},re=n(95),ie=function e(t){var n=this;Object(h.a)(this,e),this.tags_by_name=void 0,this.wrap=function(e){return{tags:e.tags.split(" ").map((function(e){return e.split("_").join(" ")})).map((function(e){return n.tags_by_name.get(e)})).filter((function(e){return void 0!==e})),url:e.file_url,id:e.id,preview_url:e.preview_url}},this.tags_by_name=Object(re.a)(t.map((function(e){return[e.name,e]})))},ce=n(205),oe=n(206),ue=n(207),le=n(208),de=n(209),je=n(204),ge=n(96),me=n.n(ge);function be(e){return he.map((function(t){var n=t.max,s=t.min;return me()(e.filter((function(e){var t=e.count;return n>=t&&t>=s})))}))}var pe,he=[{max:1e5,min:500},{max:1e5,min:500},{max:1e5,min:500},{max:500,min:100},{max:500,min:100},{max:500,min:100},{max:500,min:100},{max:500,min:100},{max:100,min:25},{max:25,min:1},{max:25,min:1},{max:1,min:1}],ve=function(e){var t=e.all_tags,n=Me();return t.length>0?Object(z.jsx)(je.a,{variant:"contained",onClick:function(){return n(S(be(t)))},id:"start",children:"Start"}):Object(z.jsx)(B.a,{})},fe="https://www.sakugabooru.com/post?tags=",Oe=function(e){var t=ae(e),n='"'+e.guess+'" ';return{missing:"No guess",correct:n+"\ud83c\udf89 was correct \ud83c\udf8a",incorrect:n+"was incorrect"}[t.result]},xe=Object(l.a)({root:{minHeight:250}}),_e=Object(l.a)({root:{paddingBottom:56}}),ye=function(e){var t=e.rounds,n=e.all_tags,s=Me(),a=xe(),r=_e();return Object(z.jsxs)(Z.a,{classes:r,children:[Object(z.jsx)($.a,{variant:"h3",component:"h1",gutterBottom:!0,align:"center",children:"Game Summary"}),Object(z.jsx)("div",{id:"play-again",children:Object(z.jsx)(je.a,{variant:"contained",onClick:function(){return s(S(be(n)))},color:"primary",children:"Play Again"})}),Object(z.jsx)(ce.a,{container:!0,spacing:2,children:t.map((function(e,t){return Object(z.jsx)(ce.a,{item:!0,className:"round-summary",xs:12,sm:6,md:4,children:Object(z.jsx)(oe.a,{classes:a,children:Object(z.jsxs)(ue.a,{href:fe+e.tag.name.split(" ").join("_"),target:"_blank",children:[Object(z.jsx)(le.a,{component:"img",title:"Image thumbnail of a clip from "+e.videos[0].tags[0].name,alt:"Image thumbnail of a clip from "+e.videos[0].tags[0].name,image:e.videos[0].preview_url}),Object(z.jsxs)(de.a,{children:[Object(z.jsx)($.a,{gutterBottom:!0,variant:"h5",component:"h2",children:e.tag.name}),Object(z.jsx)($.a,{variant:"body2",component:"p",children:Oe(e.guess)})]})]})})},t)}))})]})},we=n(40),Ne=n(5),Se=n(162),Ce=n(210),ke=n(211),Ie=n(223),Ee=n(2),Te=Object(l.a)((function(e){return{root:{display:"flex",height:22,alignItems:"center",color:e.palette.background.default},active:{color:e.palette.text.primary},circle:{width:6,height:6,borderRadius:"50%",border:"1px solid #aaa",backgroundColor:"currentColor"},completed:{color:e.palette.secondary.main,zIndex:1,fontSize:18,border:"none"},correct:{color:e.palette.primary.main}}})),Re=function(e){var t=Te();return function(n){var s=n.active,a=n.completed,r=t.circle;return a&&(r+=" "+t.completed,e&&(r+=" "+t.correct)),Object(z.jsx)("div",{className:Object(Ee.a)(t.root,Object(we.a)({},t.active,s)),children:Object(z.jsx)("div",{className:r})})}},Fe=Object(l.a)({root:{background:"rgba(2, 2, 2, .5)",zIndex:1e5,height:22,padding:8,margin:5,borderRadius:"10px",position:"fixed",bottom:10,left:"50%",transform:"translateX(-50%)"}}),Be=Object(Ne.a)({root:{display:"none"}})(Se.a),Pe=function(e){var t=e.activeStep,n=e.steps,s=e.guesses,a=Fe(),r=Re(!0),i=Re(!1);return Object(z.jsx)(Ce.a,{activeStep:t,className:a.root,connector:Object(z.jsx)(Be,{}),children:n.map((function(e,t){var n=s[t]&&"correct"===ae(s[t]).result;return Object(z.jsx)(ke.a,{children:Object(z.jsx)(Ie.a,{StepIconComponent:n?r:i})},t)}))})},ze=n(220),Ae=n(212),He=n(213),Ge=n(214),Le=n(215),De=n(49),Ye=Object(l.a)({root:{position:"fixed",zIndex:999,bottom:0,width:"100%",marginTop:-56}}),Je=function(){var e=window.location.pathname,t=Object(s.useState)(e),n=Object(o.a)(t,2),a=n[0],r=n[1],i=Ye();return Object(z.jsx)(ze.a,{className:i.root,children:Object(z.jsxs)(Ae.a,{value:a,onChange:function(e,t){r(t)},showLabels:!0,children:[Object(z.jsx)(He.a,{label:"Play",value:"/",icon:Object(z.jsx)(Ge.a,{}),component:De.b,to:"/"}),Object(z.jsx)(He.a,{label:"History",value:"/history",icon:Object(z.jsx)(Le.a,{}),component:De.b,to:"/history"})]})})};!function(e){e[e.GENERAL=0]="GENERAL",e[e.ARTIST=1]="ARTIST",e[e.COPYRIGHT=3]="COPYRIGHT",e[e.CHARACTER=4]="CHARACTER"}(pe||(pe={}));var Me=function(){return Object(u.b)()};var Ve=function(){var e,t=Object(u.c)((function(e){return e.app})),n=t.guesses,r=t.index,i=t.videos,l=t.guess_to_show,d=t.playing,j=t.tags,g=Object(u.c)((function(e){for(var t=e.app,n=t.tags.length,s=[],a=0;a<n;a++){var r;s.push({tag:t.tags[a],videos:null===(r=t.videos[a])||void 0===r?void 0:r.filter((function(e){return e.played})),guess:t.guesses[a]})}return s})),m=Object(u.c)((function(e){var t=e.app.guess_to_show;return void 0===t?void 0:ae(e.app.guesses[t])})),b=Object(s.useState)([]),p=Object(o.a)(b,2),h=p[0],v=p[1],f=Object(s.useState)(void 0),O=Object(o.a)(f,2),x=O[0],_=O[1];return Object(s.useEffect)((function(){(function(){return V.apply(this,arguments)})().then((function(e){v(e),_(new ie(e))}))}),[]),!d&&n.length>0&&void 0===l?Object(z.jsxs)(a.a.Fragment,{children:[Object(z.jsx)(ye,{rounds:g,all_tags:h}),Object(z.jsx)(Je,{})]}):Object(z.jsxs)("div",{id:"game",children:[!d&&0===n.length&&Object(z.jsxs)(a.a.Fragment,{children:[Object(z.jsx)(ve,{all_tags:h}),Object(z.jsx)(Je,{})]}),d&&j.length>0&&x&&Object(z.jsxs)(a.a.Fragment,{children:[Object(z.jsx)(K,{tag:j[r],videos:null!==(e=i[r])&&void 0!==e?e:[],video_wrapper:x,should_play:void 0===l}),void 0===l&&i[r]&&Object(z.jsx)(D,{all_tags:h})]}),(d||r>0)&&j.length>0&&Object(z.jsx)(Pe,{activeStep:r,steps:j.map((function(e){return e.name})),guesses:n}),void 0!==l&&void 0!==m&&Object(z.jsx)(ne,Object(c.a)(Object(c.a)({},m),n[l]))]})},We=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,225)).then((function(t){var n=t.getCLS,s=t.getFID,a=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),s(e),a(e),r(e),i(e)}))},Xe=n(217),qe=Object(p.b)({name:"history",initialState:{guesses:[],page:0,num_guesses:0},reducers:{set_guesses:function(e,t){e.guesses=t.payload.guesses,e.page=t.payload.page},set_num_guesses:function(e,t){e.num_guesses=t.payload}}}),Ke=qe.actions,Qe=Ke.set_guesses,Ue=Ke.set_num_guesses,Ze=function(e){var t=e.page,n=e.page_size;return function(e){O.guesses.orderBy("date").reverse().offset(t*n).limit(n).toArray().then((function(n){return e(Qe({page:t,guesses:n}))}))}},$e=qe.reducer,et=Object(p.a)({reducer:{app:R,history:$e}}),tt=n(218),nt=n(13),st=n(222),at=Object(l.a)({pagination:{margin:"1em 0"},container:{paddingBottom:56}}),rt=function(e,t){var n='"'+e+'" ';return{missing:"No guess",correct:n+"\ud83c\udf89 was correct \ud83c\udf8a",incorrect:n+"was incorrect"}[ae({guess:e,answers:t}).result]},it=function(e){var t=e.videos[e.videos.length-1],n=Object(Q.sortBy)(t.tags,["count"]),s=n[n.length-1].name;return Object(z.jsx)(ce.a,{item:!0,className:"round-summary",xs:12,sm:6,md:4,children:Object(z.jsx)(oe.a,{children:Object(z.jsxs)(ue.a,{href:fe+s.split(" ").join("_"),target:"_blank",children:[Object(z.jsx)(le.a,{component:"img",title:"Image thumbnail of a clip from "+e.videos[0].tags[0].name,alt:"Image thumbnail of a clip from "+e.videos[0].tags[0].name,image:e.videos[0].preview_url}),Object(z.jsxs)(de.a,{children:[Object(z.jsx)($.a,{gutterBottom:!0,variant:"h5",component:"h2",children:s}),Object(z.jsx)($.a,{variant:"body2",component:"p",children:rt(e.guess,n)})]})]})})},e.id)},ct=function(){var e=Me(),t=Object(u.c)((function(e){return e.history})),n=t.guesses,r=t.num_guesses,i=t.page,c=at();Object(s.useEffect)((function(){return e((function(e){O.guesses.count().then((function(t){return e(Ue(t))}))}))}),[e]),Object(s.useEffect)((function(){return e(Ze({page:0,page_size:12}))}),[e]);var o=Object(z.jsxs)(a.a.Fragment,{children:[Object(z.jsx)(ce.a,{container:!0,spacing:2,children:n.map(it)}),Object(z.jsx)(st.a,{className:c.pagination,page:i+1,count:Math.ceil(r/12),onChange:function(t,n){e(Ze({page:n-1,page_size:12}))}})]});return Object(z.jsxs)(a.a.Fragment,{children:[Object(z.jsx)(Z.a,{className:c.container,children:0===n.length?Object(z.jsx)("h1",{children:"No game history"}):o}),Object(z.jsx)(Je,{})]})},ot=n(97),ut=n(216),lt=n(60),dt=Object(ot.a)({palette:{type:"dark",primary:ut.a,secondary:lt.a}});i.a.render(Object(z.jsx)(a.a.StrictMode,{children:Object(z.jsxs)(Xe.a,{theme:dt,children:[Object(z.jsx)(tt.a,{}),Object(z.jsx)(u.a,{store:et,children:Object(z.jsx)(De.a,{children:Object(z.jsxs)(nt.c,{children:[Object(z.jsx)(nt.a,{path:"/history",children:Object(z.jsx)(ct,{})}),Object(z.jsx)(nt.a,{path:"/",children:Object(z.jsx)(Ve,{})})]})})})]})}),document.getElementById("root")),We()}},[[160,1,2]]]);
//# sourceMappingURL=main.33cbddb9.chunk.js.map