(this.webpackJsonpaniguesser=this.webpackJsonpaniguesser||[]).push([[0],{125:function(e,t,n){},131:function(e,t,n){"use strict";n.r(t);var r=n(0),s=n.n(r),a=n(11),i=n.n(a),c=(n(94),n(24)),u=n(32),o=n(68),l=n.n(o),d=(n(125),n(20)),m=n(176),g=n(170),v=n(171),j=n(177),f=n(69),p=n(43),b={videos:[],guesses:[],index:0,guess_to_show:void 0,playing:!1,tags:[]},h=Object(p.b)({name:"app",initialState:b,reducers:{change_video:function(e,t){var n,r=t.payload,s=null===(n=e.guesses[e.index])||void 0===n?void 0:n.guess;e.guesses[e.index]={guess:s,answers:r.tags},e.videos.push(r)},submit_guess:function(e){var t,n,r=e.guesses,s=e.index,a=e.videos;(e.guess_to_show=s,r[s])||(r[s]={answers:null!==(t=null===(n=a[a.length-1])||void 0===n?void 0:n.tags)&&void 0!==t?t:[]})},show_next_tag:function(e){var t=e.index;t+1<ne.length?e.index=t+1:(e.index=0,e.playing=!1),e.guess_to_show=void 0},start:function(e,t){e.index=0,e.guesses=[],e.playing=!0,e.tags=t.payload},change_guess:function(e,t){var n,r,s=t.payload,a=e.videos,i=e.index;e.guesses[i]={guess:s,answers:null!==(n=null===(r=a[a.length-1])||void 0===r?void 0:r.tags)&&void 0!==n?n:[]}}}}),x=h.actions,O=x.change_video,_=x.show_next_tag,w=x.start,y=x.submit_guess,C=x.change_guess,T=h.reducer,S=n(6),E={keys:[function(e){return e.name}],baseSort:function(e,t){return t.item.count-e.item.count}},A=function(e,t){var n=t.inputValue;return n?Object(f.a)(e,n,E).slice(0,100):[]},N=function(e){var t=e.all_tags,n=ae(),s=Object(r.useState)(null),a=Object(c.a)(s,2),i=a[0],u=a[1];return Object(S.jsxs)("form",{id:"guess",onSubmit:function(e){e.preventDefault(),i&&n(y())},children:[Object(S.jsx)(j.a,{selectOnFocus:!0,clearOnBlur:!0,autoHighlight:!0,autoComplete:!0,disableClearable:!0,clearOnEscape:!0,options:t,style:{width:300},filterOptions:A,getOptionLabel:function(e){return e.name},onChange:function(e,t){var r;u(t),n(C(null!==(r=null===t||void 0===t?void 0:t.name)&&void 0!==r?r:""))},renderInput:function(e){return Object(S.jsx)(m.a,Object(d.a)(Object(d.a)({},e),{},{label:"Guess the title",variant:"filled",autoFocus:!0}))}}),Object(S.jsx)(g.a,{type:"submit",children:Object(S.jsx)(v.a,{children:"send"})})]})},R=n(33),k=n.n(R),F=n(55),I=n(42);function G(){return(G=Object(F.a)(k.a.mark((function e(){var t,n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/tag.json?limit=0&order=count&type="+D.COPYRIGHT);case 2:return t=e.sent,e.next=5,t.json();case 5:return n=e.sent.map(L),e.abrupt("return",n.filter((function(e){return e.count>0})));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e){return P.apply(this,arguments)}function P(){return(P=Object(F.a)(k.a.mark((function e(t){var n,r,s,a,i,c,u;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.tag,s=t.page,a=null!==(n=a=void 0===s?void 0:s)&&void 0!==n?n:Object(I.random)(r.count),i="/api/post.json?limit=1&page="+a+"&tags="+r.name.replaceAll(" ","_"),e.next=5,fetch(i);case 5:return c=e.sent,e.next=8,c.json();case 8:if(!Y((u=e.sent)[0])){e.next=13;break}return e.abrupt("return",{data:u[0],page:a});case 13:return e.abrupt("return",H({tag:r,page:B(a,r)}));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var L=function(e){return{ambiguous:e.ambiguous,count:e.count,id:e.id,name:e.name.replaceAll("_"," "),type:e.type}},B=function(e,t){return(e+1)%t.count};function Y(e){return e&&e.file_url&&("mp4"===e.file_ext||"webm"===e.file_ext)&&e.id}var D,J=function(e){var t=e.tag,n=e.video,s=e.video_wrapper,a=Object(r.useState)(void 0),i=Object(c.a)(a,2),u=i[0],o=i[1],l=ae();Object(r.useEffect)((function(){var e=!0;return H({tag:t}).then((function(t){if(e){var n=s.wrap(t.data);l(O(n)),o(t.page)}})),function(){e=!1}}),[t,s,l]);var d=function(e){var t=s.wrap(e.data);l(O(t)),o(e.page)};return Object(S.jsx)("video",{muted:!0,preload:"auto",autoPlay:!0,src:null===n||void 0===n?void 0:n.url,onEnded:function(){var e=B(u,t);H({tag:t,page:e}).then(d)}})},M=n(173),V=function(e){return e.length>0?Object(S.jsxs)("p",{children:["it was ",Object(I.sortBy)(e,(function(e){return e.count}))[e.length-1].name]}):null},q=function(e){var t=e.guess_result;return t.match_result.matches&&t.guess.guess?Object(S.jsxs)("div",{id:"guess-result",className:"controls correct",children:[Object(S.jsx)("p",{children:t.guess.guess}),!t.match_result.exact&&Object(S.jsxs)("p",{children:["(",t.match_result.closest,")"]}),Object(S.jsx)("h1",{children:"\ud83c\udf89 is correct \ud83c\udf8a"})]}):t.guess.guess?Object(S.jsxs)("div",{id:"guess-result",className:"controls wrong",children:[Object(S.jsx)("p",{id:"incorrect-guess",children:t.guess.guess}),Object(S.jsx)("h1",{children:"is incorrect"}),V(t.guess.answers)]}):Object(S.jsxs)("div",{id:"guess-result",className:"controls wrong",children:[Object(S.jsx)("h1",{children:"No guess"}),V(t.guess.answers)]})},z=function(e){var t=e.score,n=e.max_score;return Object(S.jsxs)("p",{id:"score",className:"controls",children:["Correct: ",t,"/",n]})},K=n(80),Q=function(e){var t,n;if(!e.guess)return{matches:!1,exact:!1};var r=new K.a(e.answers.map((function(e){return e.name})),{includeScore:!0,threshold:.1}).search(e.guess);return{matches:r.length>0,exact:0===(null===(t=r[0])||void 0===t?void 0:t.score),closest:null===(n=r[0])||void 0===n?void 0:n.item}},U=n(12),W=n(13),X=n(77),Z=function(){function e(t){Object(U.a)(this,e),this.tags_by_name=void 0,this.tags_by_name=Object(X.a)(t.map((function(e){return[e.name,e]})))}return Object(W.a)(e,[{key:"wrap",value:function(e){var t=this;return{tags:e.tags.split(" ").map((function(e){return e.replaceAll("_"," ")})).map((function(e){return t.tags_by_name.get(e)})).filter((function(e){return void 0!==e})),url:e.file_url,id:e.id}}}]),e}(),$=n(172),ee=n(78),te=function(e){var t=e.duration,n=e.on_time_over,s=e.interval,a=void 0===s?50:s,i=e.className,c=e.count_down,u=void 0!==c&&c,o=e.show_emergency_color,l=void 0!==o&&o,d=1e3*t/a,m=Object(ee.useTimer)({endTime:d,interval:a,onTimeOver:n}),g=m.time,v=m.start,j=m.reset;Object(r.useEffect)((function(){return v(),j}),[j,v]);var f=function(e){return 100*(u?d-e:e)/d};return Object(S.jsx)($.a,{color:f(g)<25&&l?"secondary":"primary",variant:"determinate",value:f(g),className:i})};!function(e){e[e.GENERAL=0]="GENERAL",e[e.ARTIST=1]="ARTIST",e[e.COPYRIGHT=3]="COPYRIGHT",e[e.CHARACTER=4]="CHARACTER"}(D||(D={}));var ne=[{max:1e5,min:500},{max:1e5,min:500},{max:1e5,min:500},{max:1e5,min:500},{max:1e5,min:500},{max:500,min:100},{max:500,min:100},{max:500,min:100},{max:500,min:100},{max:500,min:100},{max:500,min:100},{max:500,min:100},{max:100,min:25},{max:100,min:25},{max:100,min:25},{max:25,min:1},{max:25,min:1},{max:1,min:1}];function re(e,t){return void 0!==t?e+1:e}function se(e,t){for(var n=0,r=0;r<t;r++)Q(e[r]).matches&&(n+=1);return n}var ae=function(){return Object(u.b)()};var ie=function(){var e=Object(u.c)((function(e){return e.app})),t=e.guesses,n=e.index,a=e.videos,i=e.guess_to_show,o=e.playing,d=e.tags,m=ae(),g=Object(r.useState)([]),v=Object(c.a)(g,2),j=v[0],f=v[1],p=Object(r.useState)(void 0),b=Object(c.a)(p,2),h=b[0],x=b[1];return Object(r.useEffect)((function(){(function(){return G.apply(this,arguments)})().then((function(e){f(e),x(new Z(e))}))}),[]),Object(S.jsxs)(s.a.Fragment,{children:[void 0!==i&&Object(S.jsx)(te,{duration:4,on_time_over:function(){return m(_())},className:"controls timer"}),o&&Object(S.jsx)(z,{score:se(t,re(n,i)),max_score:re(n,i)}),0===j.length&&Object(S.jsx)(te,{duration:.8}),!o&&Object(S.jsx)(M.a,{variant:"contained",disabled:0===j.length,onClick:function(){return m(w(function(e){return ne.map((function(t){var n=t.max,r=t.min;return l()(e.filter((function(e){var t=e.count;return n>=t&&t>=r})))}))}(j)))},id:"start",children:"Start"}),o&&d.length>0&&void 0===i&&h&&Object(S.jsxs)(s.a.Fragment,{children:[Object(S.jsx)(te,{duration:30,on_time_over:function(){return m(y())},count_down:!0,show_emergency_color:!0,className:"controls timer"}),Object(S.jsx)(J,{tag:d[n],video:a[a.length-1],video_wrapper:h})]}),void 0!==i&&Object(S.jsx)(q,{guess_result:{guess:t[i],match_result:Q(t[i])}}),o&&void 0===i&&Object(S.jsx)(N,{all_tags:j})]})},ce=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,178)).then((function(t){var n=t.getCLS,r=t.getFID,s=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),r(e),s(e),a(e),i(e)}))},ue=n(175),oe=n(79),le=n(174),de=n(46),me=Object(p.a)({reducer:{app:T}}),ge=Object(oe.a)({palette:{type:"dark",primary:le.a,secondary:de.a}});i.a.render(Object(S.jsx)(s.a.StrictMode,{children:Object(S.jsx)(ue.a,{theme:ge,children:Object(S.jsx)(u.a,{store:me,children:Object(S.jsx)(ie,{})})})}),document.getElementById("root")),ce()},94:function(e,t,n){}},[[131,1,2]]]);
//# sourceMappingURL=main.20026eb9.chunk.js.map