(this.webpackJsonpaniguesser=this.webpackJsonpaniguesser||[]).push([[0],{127:function(e,t,n){},133:function(e,t,n){"use strict";n.r(t),n.d(t,"dark_theme",(function(){return ye}));var s=n(0),a=n.n(s),r=n(11),i=n.n(r),c=(n(94),n(24)),o=n(29),u=n(71),l=n.n(u),d=(n(127),n(20)),m=n(188),g=n(174),j=n(175),v=n(189),h=n(72),p=n(43),f={videos:[],guesses:[],index:0,guess_to_show:void 0,playing:!1,tags:[]},b=Object(p.b)({name:"app",initialState:f,reducers:{change_video:function(e,t){var n,s=t.payload,a=e.index,r=null===(n=e.guesses[a])||void 0===n?void 0:n.guess;e.guesses[a]={guess:r,answers:s.tags},e.videos[a]?e.videos[a].push(s):e.videos[a]=[s]},submit_guess:function(e){var t,n,s=e.guesses,a=e.index,r=e.videos[a];void 0!==r&&(e.guess_to_show=a,s[a]||(s[a]={answers:null!==(t=null===(n=r[r.length-1])||void 0===n?void 0:n.tags)&&void 0!==t?t:[]}))},show_next_tag:function(e){var t=e.index;t+1<me.length?e.index=t+1:(e.index=0,e.playing=!1),e.guess_to_show=void 0},start:function(e,t){e.index=0,e.guesses=[],e.playing=!0,e.tags=t.payload},change_guess:function(e,t){var n,s,a=t.payload,r=e.index,i=e.videos[r];i&&(e.guesses[r]={guess:a,answers:null!==(n=null===(s=i[i.length-1])||void 0===s?void 0:s.tags)&&void 0!==n?n:[]})}}}),x=b.actions,O=x.change_video,_=x.show_next_tag,w=x.start,y=x.submit_guess,C=x.change_guess,T=b.reducer,A=n(5),N={keys:[function(e){return e.name}],baseSort:function(e,t){return t.item.count-e.item.count}},S=function(e,t){var n=t.inputValue;return n?Object(h.a)(e,n,N).slice(0,100):[]},k=function(e){var t=e.all_tags,n=he(),a=Object(s.useState)(null),r=Object(c.a)(a,2),i=r[0],o=r[1];return Object(A.jsxs)("form",{id:"guess",onSubmit:function(e){e.preventDefault(),i&&n(y())},children:[Object(A.jsx)(v.a,{selectOnFocus:!0,clearOnBlur:!0,autoHighlight:!0,autoComplete:!0,disableClearable:!0,clearOnEscape:!0,options:t,style:{width:300},filterOptions:S,getOptionLabel:function(e){return e.name},onChange:function(e,t){var s;o(t),n(C(null!==(s=null===t||void 0===t?void 0:t.name)&&void 0!==s?s:""))},renderInput:function(e){return Object(A.jsx)(m.a,Object(d.a)(Object(d.a)({},e),{},{label:"Guess the title",variant:"filled",autoFocus:!0}))}}),Object(A.jsx)(g.a,{type:"submit",children:Object(A.jsx)(j.a,{children:"send"})})]})},E=n(34),R=n.n(E),I=n(55),F=n(42);function H(){return(H=Object(I.a)(R.a.mark((function e(){var t,n;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/tag.json?limit=0&order=count&type="+D.COPYRIGHT);case 2:return t=e.sent,e.next=5,t.json();case 5:return n=e.sent.map(B),e.abrupt("return",n.filter((function(e){return e.count>0})));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e){return G.apply(this,arguments)}function G(){return(G=Object(I.a)(R.a.mark((function e(t){var n,s,a,r,i,c,o;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.tag,a=t.page,r=null!==(n=r=void 0===a?void 0:a)&&void 0!==n?n:Object(F.random)(s.count),i="/api/post.json?limit=1&page="+r+"&tags="+s.name.replaceAll(" ","_")+" rating:safe",e.next=5,fetch(i);case 5:return c=e.sent,e.next=8,c.json();case 8:if(!Y((o=e.sent)[0])){e.next=13;break}return e.abrupt("return",{data:o[0],page:r});case 13:return e.abrupt("return",P({tag:s,page:L(r,s)}));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var B=function(e){return{ambiguous:e.ambiguous,count:e.count,id:e.id,name:e.name.replaceAll("_"," "),type:e.type}},L=function(e,t){return(e+1)%t.count};function Y(e){return e&&e.file_url&&("mp4"===e.file_ext||"webm"===e.file_ext)&&e.id}var D,J=function(e){var t=e.tag,n=e.video,a=e.video_wrapper,r=Object(s.useState)(void 0),i=Object(c.a)(r,2),o=i[0],u=i[1],l=he();Object(s.useEffect)((function(){var e=!0;return P({tag:t}).then((function(t){if(e){var n=a.wrap(t.data);l(O(n)),u(t.page)}})),function(){e=!1}}),[t,a,l]);var d=function(e){var t=a.wrap(e.data);l(O(t)),u(e.page)};return Object(A.jsx)("video",{muted:!0,preload:"auto",autoPlay:!0,src:null===n||void 0===n?void 0:n.url,onEnded:function(){var e=L(o,t);P({tag:t,page:e}).then(d)}})},M=n(185),V=function(e){return e.length>0?Object(A.jsxs)("p",{children:["it was ",Object(F.sortBy)(e,(function(e){return e.count}))[e.length-1].name]}):null},q=function(e){var t=e.guess_result;return t.match_result.matches&&t.guess.guess?Object(A.jsxs)("div",{id:"guess-result",className:"controls correct",children:[Object(A.jsx)("p",{children:t.guess.guess}),!t.match_result.exact&&Object(A.jsxs)("p",{children:["(",t.match_result.closest,")"]}),Object(A.jsx)("h1",{children:"\ud83c\udf89 is correct \ud83c\udf8a"})]}):t.guess.guess?Object(A.jsxs)("div",{id:"guess-result",className:"controls wrong",children:[Object(A.jsx)("p",{id:"incorrect-guess",children:t.guess.guess}),Object(A.jsx)("h1",{children:"is incorrect"}),V(t.guess.answers)]}):Object(A.jsxs)("div",{id:"guess-result",className:"controls wrong",children:[Object(A.jsx)("h1",{children:"No guess"}),V(t.guess.answers)]})},z=function(e){var t=e.score,n=e.max_score;return Object(A.jsxs)("p",{id:"score",className:"controls",children:["Correct: ",t,"/",n]})},K=n(83),Q=function(e){var t,n;if(!e.guess)return{matches:!1,exact:!1};var s=new K.a(e.answers.map((function(e){return e.name})),{includeScore:!0,threshold:.1}).search(e.guess);return{matches:s.length>0,exact:0===(null===(t=s[0])||void 0===t?void 0:t.score),closest:null===(n=s[0])||void 0===n?void 0:n.item}},U=n(13),W=n(14),X=n(80),Z=function(){function e(t){Object(U.a)(this,e),this.tags_by_name=void 0,this.tags_by_name=Object(X.a)(t.map((function(e){return[e.name,e]})))}return Object(W.a)(e,[{key:"wrap",value:function(e){var t=this;return{tags:e.tags.split(" ").map((function(e){return e.replaceAll("_"," ")})).map((function(e){return t.tags_by_name.get(e)})).filter((function(e){return void 0!==e})),url:e.file_url,id:e.id,preview_url:e.preview_url}}}]),e}(),$=n(176),ee=n(81),te=function(e){var t=e.duration,n=e.on_time_over,a=e.interval,r=void 0===a?50:a,i=e.className,c=e.count_down,o=void 0!==c&&c,u=e.show_emergency_color,l=void 0!==u&&u,d=1e3*t/r,m=Object(ee.useTimer)({endTime:d,interval:r,onTimeOver:n}),g=m.time,j=m.start,v=m.reset;Object(s.useEffect)((function(){return j(),v}),[v,j]);var h=function(e){return 100*(o?d-e:e)/d};return Object(A.jsx)($.a,{color:h(g)<25&&l?"secondary":"primary",variant:"determinate",value:h(g),className:i})},ne=n(177),se=n(178),ae=n(179),re=n(180),ie=n(181),ce=n(182),oe=n(183),ue=n(184),le=Object(ne.a)({root:{minHeight:250}}),de=function(e){var t=e.rounds,n=e.all_tags,s=he(),a=le();return Object(A.jsxs)(ue.a,{children:[Object(A.jsx)(se.a,{container:!0,spacing:2,children:t.map((function(e,t){return Object(A.jsx)(se.a,{item:!0,className:"round-summary",xs:12,sm:6,md:4,children:Object(A.jsx)(ae.a,{classes:a,children:Object(A.jsxs)(re.a,{href:"https://www.sakugabooru.com/post?tags="+e.tag.name.replaceAll(" ","_"),children:[Object(A.jsx)(ie.a,{component:"img",title:"Image thumbnail of a clip from "+e.videos[0].tags[0].name,alt:"Image thumbnail of a clip from "+e.videos[0].tags[0].name,image:e.videos[0].preview_url}),Object(A.jsxs)(ce.a,{children:[Object(A.jsx)(oe.a,{gutterBottom:!0,variant:"h5",component:"h2",children:e.tag.name}),Object(A.jsx)(oe.a,{variant:"body2",component:"p",children:(n=e.guess,n.guess?'"'+n.guess+'" '+(Q(n).matches?"\ud83c\udf89 was correct \ud83c\udf8a":"was incorrect"):"No guess")})]})]})})},t);var n}))}),Object(A.jsx)("div",{id:"play-again",children:Object(A.jsx)(M.a,{variant:"contained",onClick:function(){return s(w(ge(n)))},color:"primary",children:"Play Again"})})]})};!function(e){e[e.GENERAL=0]="GENERAL",e[e.ARTIST=1]="ARTIST",e[e.COPYRIGHT=3]="COPYRIGHT",e[e.CHARACTER=4]="CHARACTER"}(D||(D={}));var me=[{max:1e5,min:500},{max:1e5,min:500},{max:1e5,min:500},{max:1e5,min:500},{max:1e5,min:500},{max:500,min:100},{max:500,min:100},{max:500,min:100},{max:500,min:100},{max:500,min:100},{max:500,min:100},{max:500,min:100},{max:100,min:25},{max:100,min:25},{max:100,min:25},{max:25,min:1},{max:25,min:1},{max:1,min:1}];function ge(e){return me.map((function(t){var n=t.max,s=t.min;return l()(e.filter((function(e){var t=e.count;return n>=t&&t>=s})))}))}function je(e,t){return void 0!==t?e+1:e}function ve(e,t){for(var n=0,s=0;s<t;s++)Q(e[s]).matches&&(n+=1);return n}var he=function(){return Object(o.b)()};var pe=function(){var e=Object(o.c)((function(e){return e.app})),t=e.guesses,n=e.index,r=e.videos,i=e.guess_to_show,u=e.playing,l=e.tags,d=Object(o.c)((function(e){for(var t=e.app,n=t.tags.length,s=[],a=0;a<n;a++)s.push({tag:t.tags[a],videos:t.videos[a],guess:t.guesses[a]});return s})),m=he(),g=Object(s.useState)([]),j=Object(c.a)(g,2),v=j[0],h=j[1],p=Object(s.useState)(void 0),f=Object(c.a)(p,2),b=f[0],x=f[1];return Object(s.useEffect)((function(){(function(){return H.apply(this,arguments)})().then((function(e){h(e),x(new Z(e))}))}),[]),Object(A.jsxs)(a.a.Fragment,{children:[void 0!==i&&Object(A.jsx)(te,{duration:4,on_time_over:function(){return m(_())},className:"controls timer"}),u&&Object(A.jsx)(z,{score:ve(t,je(n,i)),max_score:je(n,i)}),0===v.length&&Object(A.jsx)(te,{duration:.8}),!u&&0===t.length&&Object(A.jsx)(M.a,{variant:"contained",disabled:0===v.length,onClick:function(){return m(w(ge(v)))},id:"start",children:"Start"}),!u&&t.length>0&&Object(A.jsx)(de,{rounds:d,all_tags:v}),u&&l.length>0&&void 0===i&&b&&Object(A.jsxs)(a.a.Fragment,{children:[r[n]&&Object(A.jsx)(te,{duration:30,on_time_over:function(){return m(y())},count_down:!0,show_emergency_color:!0,className:"controls timer"}),Object(A.jsx)(J,{tag:l[n],video:r[n]?r[n][r[n].length-1]:void 0,video_wrapper:b})]}),void 0!==i&&Object(A.jsx)(q,{guess_result:{guess:t[i],match_result:Q(t[i])}}),u&&void 0===i&&Object(A.jsx)(k,{all_tags:v})]})},fe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,190)).then((function(t){var n=t.getCLS,s=t.getFID,a=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),s(e),a(e),r(e),i(e)}))},be=n(187),xe=n(82),Oe=n(186),_e=n(46),we=Object(p.a)({reducer:{app:T}}),ye=Object(xe.a)({palette:{type:"dark",primary:Oe.a,secondary:_e.a}});i.a.render(Object(A.jsx)(a.a.StrictMode,{children:Object(A.jsx)(be.a,{theme:ye,children:Object(A.jsx)(o.a,{store:we,children:Object(A.jsx)(pe,{})})})}),document.getElementById("root")),fe()},94:function(e,t,n){}},[[133,1,2]]]);
//# sourceMappingURL=main.6b53e3b2.chunk.js.map