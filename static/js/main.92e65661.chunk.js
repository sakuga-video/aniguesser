(this.webpackJsonpaniguesser=this.webpackJsonpaniguesser||[]).push([[0],{128:function(e,t,n){},134:function(e,t,n){"use strict";n.r(t),n.d(t,"dark_theme",(function(){return Te}));var r=n(0),a=n.n(r),s=n(11),i=n.n(s),c=(n(95),n(14)),o=n(24),u=n(25),l=n(70),d=n.n(l),g=(n(128),n(177)),j=n(192),m=n(179),p=n(180),v=n(193),b=n(71),f=n(45),h={videos:[],guesses:[],index:0,guess_to_show:void 0,playing:!1,tags:[]},O=Object(f.b)({name:"app",initialState:h,reducers:{mark_played:function(e,t){var n,r=t.payload,a=e.index,s=null===(n=e.guesses[a])||void 0===n?void 0:n.guess,i=e.videos[a][r];e.guesses[a]={guess:s,answers:i.tags},i.played=!0},set_videos:function(e,t){e.videos[e.index]=t.payload},submit_guess:function(e){var t,n,r,a=e.guesses,s=e.index,i=e.videos[s];void 0!==i&&(null===(t=i[0])||void 0===t?void 0:t.played)&&(e.guess_to_show=s,a[s]||(a[s]={answers:null!==(n=null===(r=i[i.length-1])||void 0===r?void 0:r.tags)&&void 0!==n?n:[]}))},show_next_tag:function(e){var t=e.index;t+1<e.tags.length?e.index=t+1:(e.index=0,e.playing=!1),e.guess_to_show=void 0},start:function(e,t){e.index=0,e.guesses=[],e.videos=[],e.playing=!0,e.tags=t.payload},change_guess:function(e,t){var n,r,a=t.payload,s=e.index,i=e.videos[s];i&&(e.guesses[s]={guess:a,answers:null!==(n=null===(r=i[i.length-1])||void 0===r?void 0:r.tags)&&void 0!==n?n:[]})},skip_tag:function(e){e.tags.splice(e.index,1),e.index+1>=e.tags.length&&(e.index=0,e.playing=!1)}}}),x=O.actions,_=x.mark_played,w=x.show_next_tag,y=x.start,C=x.submit_guess,k=x.change_guess,S=x.skip_tag,T=x.set_videos,A=O.reducer,E=n(172),N=n(176),P=n(73),R=n(5),I=function(e){var t=e.duration,n=e.size,a=e.type,s=e.on_time_over,i=e.interval,o=void 0===i?50:i,u=e.className,l=e.count_down,d=void 0!==l&&l,g=e.show_emergency_color,j=void 0!==g&&g,m=1e3*t/o,p=Object(P.useTimer)({endTime:m,interval:o,onTimeOver:s}),v=p.time,b=p.start,f=p.reset;Object(r.useEffect)((function(){return b(),f}),[f,b]);var h=function(e){return 100*(d?m-e:e)/m},O={color:h(v)<25&&j?"secondary":"primary",variant:"determinate",value:h(v),className:u};return"linear"===a?Object(R.jsx)(E.a,Object(c.a)({},O)):Object(R.jsx)(N.a,Object(c.a)({size:n},O))},F=Object(g.a)({wrapper:{position:"relative"},fabProgress:{position:"absolute",top:-6,left:-6}}),H={keys:[function(e){return e.name}],baseSort:function(e,t){return t.item.count-e.item.count}},B=function(e,t){var n=t.inputValue;return n?Object(b.a)(e,n,H).slice(0,100):[]},G=function(e){var t=e.all_tags,n=he(),a=F(),s=Object(r.useState)(null),i=Object(o.a)(s,2),u=i[0],l=i[1];return Object(R.jsxs)("form",{id:"guess",onSubmit:function(e){e.preventDefault(),u&&n(C())},children:[Object(R.jsx)("div",{id:"guess-input",children:Object(R.jsx)(v.a,{selectOnFocus:!0,clearOnBlur:!0,autoHighlight:!0,autoComplete:!0,disableClearable:!0,clearOnEscape:!0,options:t,style:{width:300},filterOptions:B,getOptionLabel:function(e){return e.name},onChange:function(e,t){var r;l(t),n(k(null!==(r=null===t||void 0===t?void 0:t.name)&&void 0!==r?r:""))},renderInput:function(e){return Object(R.jsx)(j.a,Object(c.a)(Object(c.a)({},e),{},{label:"Guess the title",variant:"filled",autoFocus:!0}))}})}),Object(R.jsxs)("div",{className:a.wrapper,children:[Object(R.jsx)(I,{size:68,duration:30,on_time_over:function(){return n(C())},count_down:!0,show_emergency_color:!0,className:a.fabProgress}),Object(R.jsx)(m.a,{type:"submit","area-label":"submit",children:Object(R.jsx)(p.a,{})})]})]})},L=n(36),z=n.n(L),Y=n(55);function D(){return(D=Object(Y.a)(z.a.mark((function e(){var t,n;return z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/tag.json?limit=0&order=count&type="+M.COPYRIGHT);case 2:return t=e.sent,e.next=5,t.json();case 5:return n=e.sent.map(V),e.abrupt("return",n.filter((function(e){return e.count>0})));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(){return(J=Object(Y.a)(z.a.mark((function e(t){var n,r,a,s=arguments;return z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:8,r="/api/post.json?tags=rating:safe order:random ext:mp4,webm "+t.name.replaceAll(" ","_")+"&limit="+n,e.next=4,fetch(r);case 4:return a=e.sent,e.next=7,a.json();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var M,V=function(e){return{count:e.count,id:e.id,name:e.name.replaceAll("_"," ")}},W=function(e){var t,n=e.tag,s=e.videos,i=e.video_wrapper,c=he(),u=Object(r.useState)(!0),l=Object(o.a)(u,2),d=l[0],g=l[1],j=Object(r.useState)(0),m=Object(o.a)(j,2),p=m[0],v=m[1];Object(r.useEffect)((function(){var e=!0;return v(0),function(e){return J.apply(this,arguments)}(n).then((function(e){return e.map(i.wrap)})).then((function(t){e&&(t.length>0?(v(0),c(T(t))):c(S()))})),function(){e=!1}}),[n,i,c]);var b=function(){if(s.length>1){var e=(p+1)%s.length;v(e)}};return Object(R.jsxs)(a.a.Fragment,{children:[(0===s.length||d)&&Object(R.jsx)(N.a,{className:"video-loading"}),Object(R.jsx)("video",{muted:!0,onWaiting:function(){return g(!0)},onCanPlay:function(){return g(!1)},onPlay:function(){return c(_(p))},preload:"auto",autoPlay:!0,loop:1===s.length,onError:b,src:null===(t=s[p])||void 0===t?void 0:t.url,onEnded:function(){console.log("video ended"),g(!0),b()}})]})},q=n(188),K=n(80),Q=n(135),U=Object(g.a)({timer:{width:"100%"},root:{flexBasis:"400px"}}),X=function(e){return e.length>0?Object(R.jsxs)("p",{children:["it was ",Object(K.sortBy)(e,(function(e){return e.count}))[e.length-1].name]}):null},Z=function(e){var t=e.guess,n=e.answers,r=e.closest_answer,a=e.result,s=e.is_exact,i=he(),c=U(),o=Object(R.jsx)(I,{duration:4,on_time_over:function(){return i(w())},type:"linear",className:c.timer});return Object(R.jsxs)(Q.a,{id:"guess-result",className:c.root,children:["missing"!==a&&Object(R.jsx)("p",{children:t}),"correct"===a&&!s&&Object(R.jsxs)("p",{children:["(",r,")"]}),Object(R.jsx)("h1",{children:{correct:"\ud83c\udf89 is correct \ud83c\udf8a",incorrect:"is incorrect",missing:"No guess"}[a]}),"correct"!==a&&X(n),o]})},$=function(e){var t=e.score,n=e.max_score;return Object(R.jsxs)("p",{id:"score",className:"controls",children:["Correct: ",t,"/",n]})},ee=n(83),te=function(e){var t,n;if(!e.guess)return{result:"missing",is_exact:!1};var r=new ee.a(e.answers.map((function(e){return e.name})),{includeScore:!0,threshold:.1}).search(e.guess);return{result:r.length>0?"correct":"incorrect",is_exact:0===(null===(t=r[0])||void 0===t?void 0:t.score),closest_answer:null===(n=r[0])||void 0===n?void 0:n.item}},ne=n(13),re=n(81),ae=function e(t){var n=this;Object(ne.a)(this,e),this.tags_by_name=void 0,this.wrap=function(e){return{tags:e.tags.split(" ").map((function(e){return e.replaceAll("_"," ")})).map((function(e){return n.tags_by_name.get(e)})).filter((function(e){return void 0!==e})),url:e.file_url,id:e.id,preview_url:e.preview_url}},this.tags_by_name=Object(re.a)(t.map((function(e){return[e.name,e]})))},se=n(181),ie=n(182),ce=n(183),oe=n(184),ue=n(185),le=n(186),de=n(187),ge=function(e){var t=te(e),n='"'+e.guess+'" ';return{missing:"No guess",correct:n+"\ud83c\udf89 was correct \ud83c\udf8a",incorrect:n+"was incorrect"}[t.result]},je=Object(g.a)({root:{minHeight:250}}),me=function(e){var t=e.rounds,n=e.all_tags,r=he(),a=je();return Object(R.jsxs)(de.a,{children:[Object(R.jsx)(se.a,{container:!0,spacing:2,children:t.map((function(e,t){return Object(R.jsx)(se.a,{item:!0,className:"round-summary",xs:12,sm:6,md:4,children:Object(R.jsx)(ie.a,{classes:a,children:Object(R.jsxs)(ce.a,{href:"https://www.sakugabooru.com/post?tags="+e.tag.name.replaceAll(" ","_"),target:"_blank",children:[Object(R.jsx)(oe.a,{component:"img",title:"Image thumbnail of a clip from "+e.videos[0].tags[0].name,alt:"Image thumbnail of a clip from "+e.videos[0].tags[0].name,image:e.videos[0].preview_url}),Object(R.jsxs)(ue.a,{children:[Object(R.jsx)(le.a,{gutterBottom:!0,variant:"h5",component:"h2",children:e.tag.name}),Object(R.jsx)(le.a,{variant:"body2",component:"p",children:ge(e.guess)})]})]})})},t)}))}),Object(R.jsx)("div",{id:"play-again",children:Object(R.jsx)(q.a,{variant:"contained",onClick:function(){return r(y(ve(n)))},color:"primary",children:"Play Again"})})]})};!function(e){e[e.GENERAL=0]="GENERAL",e[e.ARTIST=1]="ARTIST",e[e.COPYRIGHT=3]="COPYRIGHT",e[e.CHARACTER=4]="CHARACTER"}(M||(M={}));var pe=[{max:1e5,min:500},{max:1e5,min:500},{max:1e5,min:500},{max:500,min:100},{max:500,min:100},{max:500,min:100},{max:500,min:100},{max:500,min:100},{max:100,min:25},{max:25,min:1},{max:25,min:1},{max:1,min:1}];function ve(e){return pe.map((function(t){var n=t.max,r=t.min;return d()(e.filter((function(e){var t=e.count;return n>=t&&t>=r})))}))}function be(e,t){return void 0!==t?e+1:e}function fe(e,t){for(var n=0,r=0;r<t;r++)"correct"===te(e[r]).result&&(n+=1);return n}var he=function(){return Object(u.b)()};var Oe=function(){var e,t=Object(u.c)((function(e){return e.app})),n=t.guesses,s=t.index,i=t.videos,l=t.guess_to_show,d=t.playing,g=t.tags,j=Object(u.c)((function(e){for(var t=e.app,n=t.tags.length,r=[],a=0;a<n;a++){var s;r.push({tag:t.tags[a],videos:null===(s=t.videos[a])||void 0===s?void 0:s.filter((function(e){return e.played})),guess:t.guesses[a]})}return r})),m=Object(u.c)((function(e){var t=e.app.guess_to_show;return void 0===t?void 0:te(e.app.guesses[t])})),p=he(),v=Object(r.useState)([]),b=Object(o.a)(v,2),f=b[0],h=b[1],O=Object(r.useState)(void 0),x=Object(o.a)(O,2),_=x[0],w=x[1];return Object(r.useEffect)((function(){(function(){return D.apply(this,arguments)})().then((function(e){h(e),w(new ae(e))}))}),[]),!d&&n.length>0?Object(R.jsx)(me,{rounds:j,all_tags:f}):Object(R.jsxs)("div",{id:"game",children:[d&&Object(R.jsx)($,{score:fe(n,be(s,l)),max_score:be(s,l)}),0===f.length&&Object(R.jsx)(I,{duration:.8}),!d&&0===n.length&&f.length>0&&Object(R.jsx)(q.a,{variant:"contained",disabled:0===f.length,onClick:function(){return p(y(ve(f)))},id:"start",children:"Start"}),d&&g.length>0&&void 0===l&&_&&Object(R.jsxs)(a.a.Fragment,{children:[Object(R.jsx)(W,{tag:g[s],videos:null!==(e=i[s])&&void 0!==e?e:[],video_wrapper:_}),i[s]&&Object(R.jsx)(G,{all_tags:f})]}),void 0!==l&&void 0!==m&&Object(R.jsx)(Z,Object(c.a)(Object(c.a)({},m),n[l]))]})},xe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,194)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,s=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),s(e),i(e)}))},_e=n(190),we=n(82),ye=n(189),Ce=n(47),ke=Object(f.a)({reducer:{app:A}}),Se=n(191),Te=Object(we.a)({palette:{type:"dark",primary:ye.a,secondary:Ce.a}});i.a.render(Object(R.jsx)(a.a.StrictMode,{children:Object(R.jsxs)(_e.a,{theme:Te,children:[Object(R.jsx)(Se.a,{}),Object(R.jsx)(u.a,{store:ke,children:Object(R.jsx)(Oe,{})})]})}),document.getElementById("root")),xe()},95:function(e,t,n){}},[[134,1,2]]]);
//# sourceMappingURL=main.92e65661.chunk.js.map